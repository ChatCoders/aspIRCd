#!/usr/bin/env python

"""
Copyright 2014 Sam Dodrill <shadowh511@gmail.com>
Copyright 2015-2018 Craig Saunders <root@chatfreedom.us>
Copyright 2018-2019 David Franklin <syzolin@aspircd.com>
This software is under GPL.
"""
import subprocess
subprocess.call("./autogen.sh")

from os import system
import os
installloc = ("$HOME/ircd")
installloc2 = os.getenv("HOME")

def promptUser(prompt, default):
    inp = raw_input("%s [%s]> " % (prompt, default))

    if inp == "":
        return default
    else:
        return inp

def promptYesNo(prompt, default=True):
    inp = False if promptUser(prompt, "y") == "n" else True
    return inp

configflags = ["./configure"]

art = """
                ___ ____   ____    _
  __ _ ___ _ __|_ _|  _ \ / ___|__| |
 / _` / __| '_ \| || |_) | |   / _` |
| (_| \__ \ |_) | ||  _ <| |__| (_| |
 \__,_|___/ .__/___|_| \_\\____\__,_|
          |_|
                              v5.2.0
"""

welcome ="""
Welcome to the AspIRCd Configuration script. This script will help you choose the
best compile flags for your installation of AspIRCd, whilst install is restricted to /home/<username>/ircd
"""

print(art)
print(welcome)

print("")

print("Please specify the maximum nickname length. This must be the same across")
print("all servers in your network or you risk desyncs. The maximum is 50.")

nicklen = 100
while nicklen > 51:
    if nicklen != 100:
        print "Error: you must choose a value under 50."

    nicklen = int(promptUser("Maximum nickname length?", "31"))

print("")


print("Please specify the maximum topic length. This must be the same across")
print("all servers in your network or you risk netsplits. The maximum is 780.")

topiclen = 800
while topiclen > 781:
    if topiclen != 800:
        print "Error: you must choose a value under 780."

    topiclen = int(promptUser("Maximum topic length?", "390"))

print("")

print("Would you like to use SSL encryption for client and server links? (Recommended)")

usessl = promptYesNo("SSL? (y/n)")

print("")

print("Would you like to enable shared sqlite?")
print("ideal for low-power ARM boards and budget VPSes)")

sqlite = promptYesNo("Shared sqlite? (y/n)")

print("")

print("Would you like to enable IPv6 Support?")

IPv6 = promptYesNo("IPv6? (y/n)")

configflags.append("--prefix=%s" % installloc)
configflags.append("--with-nicklen=%s" % nicklen)
configflags.append("--with-topiclen=%s" % topiclen)

if usessl:
    configflags.append("--enable-openssl")
else:
    configflags.append("--disable-openssl")

if not sqlite:
    configflags.append("")
else:
    configflags.append("--with-shared-sqlite")

if IPv6:
    configflags.append("--enable-ipv6")
else:
    configflags.append("")

print("\nThat should be it for now. Running %s" % " ".join(configflags))

print("")
print("")
print("")
raw_input("Press enter to install AspIRCd...")


system(" ".join(configflags))

system("clear")

print(art)

print("""
================================================================================================
================================================================================================
Next, run make and make install. Then copy %s/ircd/etc/example.conf to
%s/ircd/etc/ircd.conf and read through the example configuration completely to make
sure your install is tailored to your needs. After that, run %s/ircd/bin/ircd
and start to connect clients and servers as you need.

If you have any problems, please check the documentation in the doc/ folder
of the source repository. If problems persist please stop by #aspIRCd
on irc.aspircd.com and ask.
================================================================================================
================================================================================================
                     ALL RIGHTS RESERVED   Copyright (C) 2018-2019
================================================================================================
================================================================================================
                            AspIRCd IRC Daemon Software
                     For support let us know and contact us at
                             syzolin@aspircd.com
================================================================================================
================================================================================================
""" %\
    (installloc2, installloc2, installloc2))

# vim: set ts=4 sw=4 tw=0 et
